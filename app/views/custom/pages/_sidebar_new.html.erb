<div class="sidebar">
  <% show_admin_controlls = (current_user && current_user.email.in?(@partner_emails) || current_user.present? && current_user.administrator? ||  current_user.present? && current_user.projekt_manager? || current_user.present? && (current_user.administrator? || (current_user.projekt_manager? && can?(:edit, @projekt)))) %>

  <% if show_admin_controlls %>
    <%= render Shared::SidebarCardComponent.new(title: "Administration", icon_name: "cog") do |c| %>
      <% c.body do %>
        <%= render partial: 'pages/sidebar/admin_controls' %>
      <% end %>
    <% end %>
  <% end %>

  <% content_block_sidebar_name = "projekt_page_sidebar_#{projekt.id}" %>

  <% if render_custom_projekt_content_block?(content_block_sidebar_name, projekt) %>
    <%= render Shared::SidebarCardComponent.new(title: "Information", icon_name: "info-circle") do |c| %>
      <% c.body do %>
        <%= render_custom_block "projekt_page_sidebar_#{projekt.id}" %>
      <% end %>
    <% end %>
  <% end %>

  <% if projekt_feature?(projekt, "sidebar.show_phases_in_projekt_page_sidebar") %>
    <%= render Shared::SidebarCardComponent.new(title: "Phasen", icon_name: "pager") do |c| %>
      <% c.body do %>
        <%= render Pages::Projekts::SidebarPhasesNewComponent.new(projekt) %>
      <% end %>
    <% end %>
  <% end %>

  <% if projekt_feature?(projekt, 'general.enable_sdgs') && projekt.sdg_goals.any? %>
    <%= render Shared::SidebarCardComponent.new(title: 'SDGS', icon_name: "tag") do |c| %>
      <% c.body do %>
        <%= render partial: 'pages/sidebar/sdgs', locals: { projekt: projekt } %>
      <% end %>
    <% end %>
  <% end %>

  <% if projekt_feature?(projekt, 'general.enable_tags') %>
    <%= render Shared::SidebarCardComponent.new(title: 'Tags', icon_name: "tag") do |c| %>
      <% c.body do %>
        <%= render partial: 'pages/sidebar/tags', locals: { projekt: projekt } %>
      <% end %>
    <% end %>
  <% end %>

  <% if projekt_feature?(projekt, 'sidebar.show_map') %>
    <%= render Shared::SidebarCardComponent.new(title: 'Karte', icon_name: "map") do |c| %>
      <% c.body do %>
        <%= render Pages::Projekts::SidebarMapComponent.new(projekt, @default_phase_name) %>
      <% end %>
    <% end %>
  <% end %>

  <% if projekt_feature?(projekt, "sidebar.show_navigator_in_projekts_page_sidebar") %>
    <%= render Shared::SidebarCardComponent.new(title: 'Aufbau', icon_name: "list-alt") do |c| %>
      <% c.body do %>
        <%= render partial: 'pages/sidebar/projekt_list', locals: { projekts: [projekt.top_parent], current_projekt: projekt } %>
      <% end %>
    <% end %>
  <% end %>

  <% if projekt_feature?(projekt, "sidebar.projekt_page_sharing") %>
    <%= render Shared::SidebarCardComponent.new(title: 'Teilen', icon_name: "share-alt") do |c| %>
      <% c.body do %>
        <%= render "shared/social_share",
            title: projekt.page.title,
            url: url_for(only_path: false),
            description: strip_tags(projekt.page.content || '')[0..200] + '...',
            mobile: projekt.page.title
        %>
      <% end %>
    <% end %>
  <% end %>
</div>
