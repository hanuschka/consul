<div class="sidebar">
  <% show_admin_controlls = (current_user && current_user.email.in?(@partner_emails) || current_user.present? && current_user.administrator? ||  current_user.present? && current_user.projekt_manager? || current_user.present? && (current_user.administrator? || (current_user.projekt_manager? && can?(:edit, @projekt)))) %>

  <% if show_admin_controlls %>
    <div class="sidebar-card">
      <div class="sidebar-card--section">
        <h4 class="sidebar-card--header">
          <i class="fas fa-cog"></i>
          Administration
        </h4>
        <%= render partial: 'pages/sidebar/admin_controls' %>
      </div>
    </div>
  <% end %>

  <% content_block_sidebar_name = "projekt_page_sidebar_#{projekt.id}" %>

  <% if show_custom_projekt_content_block?(content_block_sidebar_name, @projekt) %>
    <div class="sidebar-card">
      <div class="sidebar-card--section">
        <h4 class="sidebar-card--header">
          <i class="fas fa-info-circle"></i>
          Information
        </h4>
        <%= render_custom_block "projekt_page_sidebar_#{projekt.id}" %>
      </div>
    </div>
  <% end %>

  <% if projekt_feature?(@custom_page.projekt, "sidebar.show_phases_in_projekt_page_sidebar") %>
    <div class="sidebar-card">
      <div class="sidebar-card--section">
        <h4 class="sidebar-card--header">
          <i class="fas fa-pager"></i>
          Phasen
        </h4>
        <%= render Pages::Projekts::SidebarPhasesNewComponent.new(projekt) %>
      </div>
    </div>
  <% end %>

  <% if projekt_feature?(@custom_page.projekt, 'general.enable_sdgs') %>
    <div class="sidebar-card">
      <div class="sidebar-card--section">
        <h4 class="sidebar-card--header">
          <i class="fas fa-tag"></i>
          SDGS
        </h4>
        <%= render partial: 'pages/sidebar/sdgs_new', locals: { projekt: projekt } %>
      </div>
    </div>
  <% end %>

  <% if projekt_feature?(@custom_page.projekt, 'general.enable_tags') %>
    <div class="sidebar-card">
      <div class="sidebar-card--section">
        <h4 class="sidebar-card--header">
          <i class="fas fa-tag"></i>
          Tags
        </h4>
        <%= render partial: 'pages/sidebar/tags_new', locals: { projekt: projekt } %>
      </div>
    </div>
  <% end %>

  <% if projekt_feature?(projekt, 'sidebar.show_map') %>
    <div class="sidebar-card">
      <div class="sidebar-card--section">
        <h4 class="sidebar-card--header">
          <i class="fas fa-map"></i>
          Karte
        </h4>
        <%= render Pages::Projekts::SidebarMapNewComponent.new(projekt, @default_phase_name) %>
      </div>
    </div>
  <% end %>

  <% if projekt_feature?(@custom_page.projekt, "sidebar.show_navigator_in_projekts_page_sidebar") %>
    <div class="sidebar-card">
      <div class="sidebar-card--section">
        <h4 class="sidebar-card--header">
          <i class="fas fa-list-alt"></i>
          Aufbau
        </h4>
        <%= render partial: 'pages/sidebar/projekt_list', locals: { projekts: [projekt.top_parent], current_projekt: projekt } %>
      </div>
    </div>
  <% end %>

  <% if projekt_feature?(@custom_page.projekt, "sidebar.projekt_page_sharing") %>
    <div class="sidebar-card">
      <div class="sidebar-card--section">
        <h4 class="sidebar-card--header">
          <i class="fas fa-share-alt"></i>
          Teilen
        </h4>
        <%= render "shared/social_share",
            title: projekt.page.title,
            url: url_for(only_path: false),
            description: strip_tags(projekt.page.content || '')[0..200] + '...',
            mobile: projekt.page.title
        %>
      </div>
    </div>
  <% end %>
</div>
