<% content_for :body_class, "polls-index" %>
<% provide :title do %><%= t("polls.index.title") %><% end %>

<%= render_custom_partial "meta_description" %>

<% content_for :canonical do %>
  <%= render "shared/canonical", href: polls_url %>
<% end %>

<%= render_custom_partial "social_meta_tags" %>
  
<main>
  
  <%= render "shared/section_header", i18n_namespace: "polls.index.section_header", image: "polls" %>
  
  <div class="row">
    <div class="small-12 medium-9 column">

      <% if extended_feature?(:intro_text_for_polls) %>
        <%=render_custom_block 'polls_welcome' %>
      <% end %>

      <% if show_polls_description? %>
        <div class="polls-description">
          <%= auto_link_already_sanitized_html wysiwyg(@active_poll.description) %>
        </div>
      <% end %>

      <%= render "shared/filter_subnav", i18n_namespace: "polls.index" %>

      <% if @polls.any? %>

        <div class='row'>
          <div class='small-6 column small'>
            <%= link_to t('polls.index.section_header.help'), '#section_help' %>
          </div>
          <div class='small-6 column small'>
            <% if extended_feature?('show_number_of_entries_in_modules') %>
              <div class='float-right'>
                <%= @all_polls.count %>
                <%= t('activerecord.models.poll', count: @all_polls.count) %>
              </div>
            <% end %>
          </div>
        </div>


        <% polls_by_geozone_restriction = @polls.group_by(&:geozone_restricted) %>

        <% if polls_by_geozone_restriction[false].present? %>
          <h3 class="section-title-divider">
            <span><%= t("polls.index.no_geozone_restricted") %></span>
          </h3>
          <%= render "poll_group", poll_group: polls_by_geozone_restriction[false] %>
        <% end %>

        <% if polls_by_geozone_restriction[true].present? %>
          <h3 class="section-title-divider">
            <span><%= t("polls.index.geozone_restricted") %></span>
          </h3>
          <%= render "poll_group", poll_group: polls_by_geozone_restriction[true] %>
        <% end %>

        <%= paginate @polls %>
      <% else %>
        <div class="callout primary margin-top">
          <%= t("polls.index.no_polls") %>
        </div>
      <% end %>

      <div id="section_help" class="margin" data-magellan-target="section_help">
        <% if extended_feature?('custom_help_text_in_modules')  %>
          <%=render_custom_block 'polls_help' %>
        <% else %>
          <p class="lead">
            <strong><%= t("polls.index.section_footer.title") %></strong>
          </p>
          <p><%= t("polls.index.section_footer.description") %></p>
        <% end %>
        <%= render_custom_partial "footer" %>
      </div>
    </div>

    <div class="small-12 medium-3 column">
      <aside class="margin-bottom">
        <%= render "shared/projekts_sidebar" %>
        <% if extended_feature?('show_geozone_filter_in_sidebar') %>
          <%= render "shared/sidebar_filter/geozones_sidebar" %>
        <% end %>
        <%= render "shared/categories", taggable: "poll" %>
        <%= render "shared/tag_cloud", taggable: "poll" %>
        <%= render SDG::Goals::TagCloudComponent.new("Poll") %>
      </aside>
    </div>
  </div>
</main>
