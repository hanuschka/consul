<% provide :title do %><%= t("devise_views.users.registrations.new.title") %><% end %>

<% form_html = capture do %>
  <h2><%= t("custom.sign_up.common.register") %></h2>

  <%= render "sign_up_progress_bar" %>

  <h4><%= t("custom.sign_up.common.information") %></h4>

  <% if @user.citizen? %>
    <p class='info-details'><%= t("custom.sign_up.user_details.information_details.citizen") %></p>
  <% else %>
    <p class='info-details'><%= t("custom.sign_up.user_details.information_details.not_citizen") %></p>
  <% end %>

  <%= form_for(@user, url: update_user_details_path(@user)) do |f| %>
    <%= render "shared/errors", resource: @user %>

    <div class="">
      <div class="">
        <%= f.text_field :first_name, placeholder: t("custom.sign_up.user_details.first_name_placeholder") %>
      </div>

      <div class="">
        <%= f.text_field :last_name, placeholder: t("custom.sign_up.user_details.last_name_placeholder") %>
      </div>
    </div>

    <% if @user.citizen? %>
      <div class="row">
        <%= render Users::RegisteredAddressFieldsComponent.new(
          resource: resource,
          selected_city_id: params[:form_registered_address_city_id].presence,
          selected_street_id: params[:form_registered_address_street_id].presence,
          selected_address_id: params[:form_registered_address_id].presence
        ) %>
      </div>

      <%= render Users::RegularAddressFieldsComponent.new(f: f, user: resource) %>

    <% else %>
      <div class="" style="display: flex; justify-content: space-between;">
        <div class="" style="width: 48%;">
          <%= f.text_field :street_name, placeholder: t("custom.sign_up.user_details.street_name_placeholder") %>
        </div>

        <div class="" style="width: 48%;">
          <%= f.text_field :street_number, placeholder: t("custom.sign_up.user_details.street_number_placeholder") %>
        </div>
      </div>

      <div class="" style="display: flex; justify-content: space-between;">
        <div class="" style="width: 48%;">
          <%= f.text_field :plz, placeholder: t("custom.sign_up.user_details.plz_placeholder") %>
        </div>

        <div class="" style="width: 48%;">
          <%= f.text_field :city_name, placeholder: t("custom.sign_up.user_details.city_name_placeholder") %>
        </div>
      </div>
    <% end %>

    <div class="row">
      <div class="user-date-of-birth">
        <%= f.date_select :date_of_birth,
                          prompt: true,
                          start_year: 1900, end_year: minimum_required_age.years.ago.year %>
      </div>
    </div>

    <% if IndividualGroup.soft.visible.any? %>
      <% IndividualGroup.soft.visible.each do |individual_group| %>
        <div class="options-group">
          <label><%= individual_group.name %></label>
          <%= f.collection_check_boxes :individual_group_value_ids, individual_group.individual_group_values, :id, :name do |b| %>
            <%= b.label(class: "checkbox-label checkbox-label--inline") { b.check_box + b.text } %>
          <% end %>
        </div>
      <% end %>
    <% end %>

    <% if @user.citizen? %>
      <div class='user-document'>
        <div class='user-document-type'>
          <%= f.select :document_type, user_document_types, prompt: "Dokument" %>
        </div>
        <div class='user-document-number'>
          <%= f.text_field :document_number, placeholder: t("custom.sign_up.user_details.document_number_placeholder"), label: false %>
        </div>
      </div>

      <label><%= t("custom.sign_up.user_details.tips") %></label>

      <div class='margin-bottom' style="display: flex; justify-content: space-between;">
        <div class='' style="width: 48%;">
          <label><%= t("custom.sign_up.user_details.card_label") %></label>
          <p><%= t("custom.sign_up.user_details.card_help") %></p>
          <%= image_tag "card.jpg" %>
        </div>

        <div class='' style="width: 48%;">
          <label><%= t("custom.sign_up.user_details.pass_label") %></label>
          <p><%= t("custom.sign_up.user_details.pass_help") %></p>
          <%= image_tag "pass_new.png" %>
        </div>
      </div>
    <% end %>

    <div class="small-12 small-centered margin-top margin-bottom-1">
      <%= f.submit t("custom.sign_up.user_details.submit"), class: "button expanded", style: "max-width:unset" %>
    </div>
  <% end %>
<% end %>

<% if Setting.new_design_enabled? %>
  <%= render Auth::AuthPageTemplateComponent.new do |c| %>
    <% c.with_form do %>
      <%= form_html %>
    <% end %>
  <% end %>
<% else %>
  <%= form_html %>
<% end %>
